import"./style-68b0bd08.js";import{A as I,E as P,T as w,l as q,S as f,g as A,a as h,L as b,s as _}from"./common-1310fad9.js";const M="https://api.spotify.com/v1",H=()=>{const e=localStorage.getItem(I),t=localStorage.getItem(P),o=localStorage.getItem(w);if(Date.now()<t)return{accessToken:e,tokenType:o};q()},N=({accessToken:e,tokenType:t},o="GET")=>({headers:{Authorization:`${t} ${e}`},method:o}),L=async e=>{const t=`${M}/${e}`;return(await fetch(t,N(H()))).json()},l=new Audio;let E;const D=e=>{e.stopPropagation();const t=document.querySelector("#profile-menu");t.classList.toggle("hidden"),t.classList.contains("hidden")||t.querySelector("li#logout").addEventListener("click",q)},F=async()=>new Promise(async(e,t)=>{const o=document.querySelector("#default-image"),c=document.querySelector("#user-profile-btn"),s=document.querySelector("#display-name"),{display_name:n,images:i}=await L(h.userInfo);i!=null&&i.length?o.classList.add("hidden"):o.classList.remove("hidden"),c.addEventListener("click",D),s.textContent=n,e({displayName:n})}),j=(e,t)=>{console.log(e.target);const o={type:f.PLAYLIST,playlist:t};history.pushState(o,"",`playlist/${t}`),x(o)},v=async(e,t)=>{const{playlists:{items:o}}=await L(e),c=document.querySelector(`#${t}`);for(let{name:s,description:n,images:i,id:a}of o){const u=document.createElement("section");u.className=" bg-black-secondary rounded p-4 hover:cursor-pointer hover:bg-light-black",u.id=a,u.setAttribute("data-type","playlist"),u.addEventListener("click",r=>j(r,a));const[{url:y}]=i;u.innerHTML=` <img src="${y}" alt="${s}"  class="rounded mb-2 object-contain shadow"/> 
                                    <h2 class="text-base font-semibold mb-4 truncate">${s}</h2>
                                    <h3 class="text-sm text-secondary line-clamp-2">${n}</h3>`,c.appendChild(u)}},B=()=>{v(h.featuredPlaylist,"featured-playlist-items"),v(h.toplists,"top-playlist-items")},O=()=>{const e=document.querySelector("#cover-content");e.innerHTML=`<h1 class="text-5xl">Hello ${E}</h1>`;const t=document.querySelector("#page-content"),o=new Map([["featured","featured-playlist-items"],["top playlists","top-playlist-items"]]);let c="";for(let[s,n]of o)c+=`<article class="p-4">
    <h1 class="text-2xl font-bold capitalize mb-4">${s}</h1>
    <section
      class="featured-songs grid grid-cols-auto-fill-cards gap-4"
      id="${n}"
    >
    </section>
  </article>`;t.innerHTML=c},R=e=>{const t=Math.floor(e/6e4),o=(e%6e3/1e3).toFixed(0);return o==60?t+1+":00":t+":"+(o<10?"0":"")+o},Y=(e,t)=>{document.querySelectorAll("#tracks .track").forEach(o=>{o.id===e?o.classList.add("bg-gray","selected"):o.classList.remove("bg-gray","selected")})},U=e=>{const t=document.querySelector("#play");t.querySelector("span").textContent="pause_circle";const o=document.querySelector(`#play-track-${e}`);o&&(o.textContent="pause")},z=e=>{const t=document.querySelector("#play");t.querySelector("span").textContent="play_circle";const o=document.querySelector(`#play-track-${e}`);o&&(o.textContent="play_arrow")},K=e=>{const t=document.querySelector("#total-song-duration");t.textContent=`0:${l.duration.toFixed(0)}`},$=()=>{l.src&&(l.paused?l.play():l.pause())},C=()=>{const t=document.querySelector("#audio-control").getAttribute("data-track-id");if(t){const o=A(b);return{currentTrackIndex:o==null?void 0:o.findIndex(s=>s.id===t),tracks:o}}return null},X=()=>{const{currentTrackIndex:e=-1,tracks:t=null}=C()??{};e>-1&&e<t.length-1&&k(null,t[e+1])},G=()=>{const{currentTrackIndex:e=-1,tracks:t=null}=C()??{};e>0&&k(null,t[e-1])},k=(e,{image:t,artistNames:o,name:c,duration:s,previewUrl:n,id:i})=>{if(e!=null&&e.stopPropagation&&e.stopPropagation(),l.src===n)$();else{console.log(t,o,c,s,n,i);const a=document.querySelector("#now-playing-image"),u=document.querySelector("#now-playing-song"),y=document.querySelector("#now-playing-artists"),r=document.querySelector("#audio-control"),d=document.querySelector("#song-info");r.setAttribute("data-track-id",i),a.src=t.url,u.textContent=c,y.textContent=o,l.src=n,l.play(),d.classList.remove("invisible")}},W=({tracks:e})=>{const t=document.querySelector("#tracks");let o=1;const c=[];for(let s of e.items.filter(n=>n.track.preview_url)){let{id:n,artists:i,name:a,album:u,duration_ms:y,preview_url:r}=s.track,d=document.createElement("section");d.id=n,d.className="track p-1 grid grid-cols-[50px_1fr_1fr_50px] items-center justify-items-start gap-4 text-secondary rounded-md hover:bg-light-black";let p=u.images.find(g=>g.height===64),m=Array.from(i,g=>g.name).join(", ");d.innerHTML=`
    <p class=" relative w-full flex items-center justify-center justify-self-center"><span class="track-no">${o++}</span></p>
      <section class="grid grid-cols-[auto_1fr] place-items-center gap-2">
        <img class="h-10 w-10" src="${p.url}" alt="${a}" />
        <article class="flex flex-col gap-2 justify-center ">
          <h2 class=" song-title text-primary text-base line-clamp-1">${a}</h2>
          <p class="text-xs line-clamp-1">${m}</p>
        </article>
      </section>
    <p class="text-sm">${u.name}</p>
    <p class="text-sm">${R(y)}</p>
    `,d.addEventListener("click",g=>Y(n));const S=document.createElement("button");S.id=`play-track-${n}`,S.className="play w-full absolute left-0 text-lg invisible material-symbols-outlined",S.textContent="play_arrow",S.addEventListener("click",g=>k(g,{image:p,artistNames:m,name:a,duration:y,previewUrl:r,id:n})),d.querySelector("p").appendChild(S),t.appendChild(d),c.push({id:n,artists:i,name:a,album:u,duration:y,previewUrl:r,artistNames:m,image:p})}_(b,c)},J=async e=>{const t=await L(`${h.playlist}/${e}`);console.log(t);const{name:o,description:c,images:s,tracks:n}=t,i=document.querySelector("#cover-content");i.innerHTML=`
        <img  class="object-contain" src="${s[0].url}" alt="${o}" />
        <section class="flex flex-col justify-center">
          <h2 id="playlist-name" class="text-5xl font-bold">${o}</h2>
          <p id="playlist-details" class="text-l pt-4">${c}</p>
          <p id="playlist-details" class="text-base">${n.items.length} songs</p>
        </section>
    `;const a=document.querySelector("#page-content");a.innerHTML=`
  <header id="playlist-header" class="mx-8  border-secondary border-b-[0.5px] z-10">
    <nav class="py-2">
      <ul class="grid grid-cols-[50px_1fr_1fr_50px] gap-4 text-secondary">
        <li class="justify-self-center">#</li>
        <li>Title</li>
        <li>Album</li>
        <li>ðŸ•‘</li>
      </ul>
    </nav>
  </header>
  <section class="px-8 text-secondary mt-4" id="tracks">
  </section>
  `,W(t),console.log(t)},T=e=>{const{scrollTop:t}=e.target,o=document.querySelector(".header"),c=document.querySelector("#cover-content"),s=c.offsetHeight,n=100-(t>=s?100:t/s*100),i=t>=o.offsetHeight?100:t/s*100;if(c.style.opacity=`${n}%`,o.style.background=`rgba(0 0 0 / ${i}%)`,history.state.type===f.PLAYLIST){document.querySelector("#cover-content");const a=document.querySelector("#playlist-header");n<=35?(a.classList.add("sticky","bg-black-secondary","px-8"),a.classList.remove("mx-8"),a.style.top=`${o.offsetHeight}px`):(a.classList.remove("sticky","bg-black-secondary","px-8"),a.classList.add("mx-8"),a.style.top="revert")}},Q=e=>{const t={type:f.PLAYLIST,playlist:e};history.pushState(t,"",`/dashboard/playlist/${e}`),x(t)},V=async()=>{const e=await L(h.userPlaylist);console.log(e);const t=document.querySelector("#user-playlists > ul");t.innerHTML="";for(let{name:o,id:c}of e.items){const s=document.createElement("li");s.textContent=o,s.className="cursor-pointer hover:text-primary",s.addEventListener("click",()=>{Q(c)}),t.appendChild(s)}},x=e=>{e.type===f.DASHBOARD?(O(),B()):e.type===f.PLAYLIST&&J(e.playlist),document.querySelector(".content").removeEventListener("scroll",T),document.querySelector(".content").addEventListener("scroll",T)};document.addEventListener("DOMContentLoaded",async()=>{const e=document.querySelector("#volume"),t=document.querySelector("#play"),o=document.querySelector("#song-duration-completed"),c=document.querySelector("#progress"),s=document.querySelector("#timeline"),n=document.querySelector("#audio-control"),i=document.querySelector("#next"),a=document.querySelector("#prev");let u;({displayName:E}=await F()),V();const y={type:f.DASHBOARD};history.pushState(y,"",""),x(y),document.addEventListener("click",()=>{const r=document.querySelector("#profile-menu");r.classList.contains("hidden")||r.classList.add("hidden")}),s.addEventListener("click",r=>{const d=window.getComputedStyle(s).width,p=r.offsetX/parseInt(d)*l.duration;l.currentTime=p,c.style.width=`${l.currentTime/l.duration*100}%`},!1),l.addEventListener("loadedmetadata",K),l.addEventListener("play",()=>{const r=n.getAttribute("data-track-id"),d=document.querySelector("#tracks"),p=d==null?void 0:d.querySelector("section.playing"),m=d==null?void 0:d.querySelector(`[id="${r}"]`);(p==null?void 0:p.id)!==(m==null?void 0:m.id)&&(p==null||p.classList.remove("playing")),m.classList.add("playing"),u=setInterval(()=>{l.paused||(o.textContent=`${l.currentTime.toFixed(0)<10?"0:0"+l.currentTime.toFixed(0):"0:"+l.currentTime.toFixed(0)}`,c.style.width=`${l.currentTime/l.duration*100}%`)},100),U(r)}),l.addEventListener("pause",()=>{u&&clearInterval(u);const r=n.getAttribute("data-track-id");z(r)}),t.addEventListener("click",$),e.addEventListener("change",()=>{l.volume=e.value/100}),i.addEventListener("click",X),a.addEventListener("click",G),window.addEventListener("popstate",r=>{x(r.state)})});
